<section class="container my-5">
  <h2 class="text-center mb-4">🎤 Mis Eventos</h2>

  <!-- Mensaje de feedback -->
  @if (mensaje) {
    <div class="alert" [class.alert-success]="tipoMensaje === 'success'" [class.alert-danger]="tipoMensaje === 'error'">
      {{ mensaje }}
    </div>
  }

  @if (cargando) {
    <p class="text-center">Cargando...</p>
  } @else if (eventos.length === 0) {
    <div class="alert alert-info text-center">No has creado ningún evento aún.</div>
  } @else {
    <div class="row g-3">
      @for (e of eventos; track e.id) {
        <div class="col-md-6">
          <div class="card shadow-sm">
            <div class="card-body">

              @if (editarId === e.id) {
                @if (esFuturo(e.fecha)) {
                  <div class="mb-2">
                    <label class="form-label">Título:</label>
                    <input class="form-control" [(ngModel)]="e.titulo" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Descripción:</label>
                    <textarea class="form-control" [(ngModel)]="e.descripcion"></textarea>
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Fecha:</label>
                    <input type="datetime-local" class="form-control" [(ngModel)]="e.fecha" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Ubicación:</label>
                    <input class="form-control" [(ngModel)]="e.ubicacion" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Cupo máximo:</label>
                    <input type="number" class="form-control" [(ngModel)]="e.cupo_maximo" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Imagen del evento (URL):</label>
                    <input type="url" class="form-control" [(ngModel)]="e.imagen" placeholder="https://..." />
                    @if (e.imagen) {
                      <div class="mt-2 text-center">
                        <img [src]="e.imagen" alt="Vista previa" style="max-width: 100px; max-height: 100px; object-fit: contain; border: 1px solid #ccc; border-radius: 4px;" />
                      </div>
                    }
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Descuento:</label>
                    <div class="input-group">
                      <input type="number" class="form-control" [(ngModel)]="nuevoDescuento" min="0" max="100" />
                      <span class="input-group-text">%</span>
                    </div>
                  </div>

                  <div class="mb-2">
                    <button class="btn btn-success btn-sm me-2" (click)="guardarEdicion(e)">Guardar</button>
                    <button class="btn btn-secondary btn-sm" (click)="editarId = null">Cancelar</button>
                  </div>
                } @else {
                  <div class="alert alert-warning">⚠️ No puedes editar un evento que ya ha ocurrido.</div>
                }
              } @else {
                <h5 class="card-title">{{ e.titulo }}</h5>
                <p>{{ e.descripcion }}</p>
                <p><strong>Fecha:</strong> {{ e.fecha | date: 'fullDate' }}</p>
                <p><strong>Ubicación:</strong> {{ e.ubicacion }}</p>
                <p><strong>Inscripciones:</strong> {{ e.cupo_maximo }} máx</p>
                <p><strong>Descuento actual:</strong> {{ e.descuento ?? 'Sin oferta' }}%</p>
                @if (e.imagen) {
                  <div class="text-center">
                    <img [src]="e.imagen" alt="Imagen del evento" style="max-width: 120px; max-height: 100px; border-radius: 4px;" />
                  </div>
                }

                @if (esFuturo(e.fecha)) {
                  <button class="btn btn-outline-warning btn-sm" (click)="activarEdicion(e.id, e.descuento)">Editar evento</button>
                } @else {
                  <div class="text-danger small">🕒 Evento finalizado</div>
                }
              }

              <hr />
              <a [routerLink]="['/organizador/reservas', e.id]" class="btn btn-outline-primary btn-sm">
                Ver inscripciones
              </a>
            </div>
          </div>
        </div>
      }
    </div>
  }
</section>
